<?xml version="1.0" encoding="UTF-8"?>
<!--
 *	Mark's Code Fractal CFKBase 3.1 Code Fractal Knowledge Base
 *
 *	Copyright 2016-2025 Mark Stephen Sobkow
 *
 *	This file is part of Mark's Code Fractal CFKBase.
 *
 *	Mark's Code Fractal CFKBase is available under dual commercial license from
 *	Mark Stephen Sobkow, or under the terms of the GNU General Public License,
 *	Version 3 or later.
 *
 *	Mark's Code Fractal CFKBase is free software: you can redistribute it and/or
 *	modify it under the terms of the GNU General Public License as published by
 *	the Free Software Foundation, either version 3 of the License, or
 *	(at your option) any later version.
 *
 *	Mark's Code Fractal CFKBase is distributed in the hope that it will be useful,
 *	but WITHOUT ANY WARRANTY; without even the implied warranty of
 *	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *	GNU General Public License for more details.
 *
 *	You should have received a copy of the GNU General Public License
 *	along with Mark's Code Fractal CFKBase.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
 *
 *	If you wish to modify and use this code without publishing your changes,
 *	or integrate it with proprietary code, please contact Mark Stephen Sobkow
 *	for a commercial license at mark.sobkow@gmail.com
 * -->
<RuleSet
	xmlns="http://msscf.org:8088/msscf/2.0.13/xsd/cfgenkb-2.13-ruleset.xsd"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:xs="http://www.w3.org/2001/XMLSchema"
	xsi:schemaLocation="http://msscf.org:8088/msscf/2.0.13/xsd/cfgenkb-2.13-ruleset.xsd http://msscf.org:8088/msscf/2.0.13/xsd/cfgenkb-2.13-ruleset.xsd"
	ToolSet="java"
	Name="src/schema/jpa/SchemaJpaSchema.java"
	Revision="3.0"
	Descr="Java JPA implementation of a $SchemaName$ schema.">

	<GenFile GenDef="SchemaDef" Name="fileSchemaJpaSchemaJava"
			GenerateOnce="false"
		ModuleName="$reference ManufacturingSchema lower JavaPackage$"
		SourceBundle="java"
		BasePackageName="$reference ManufacturingSchema lower JavaPackage$.$reference ManufacturingSchema lower SchemaName$/src/main/java"
		SubPackageName="$reference ManufacturingSchema lower JavaPackage$.$reference ManufacturingSchema lower SchemaName$.jpa"
		ExpansionClassName="$SchemaName$JpaSchemaJava"
		ExpansionKeyName="$SchemaName$JpaSchemaJava"
		ExpansionFileName="$SchemaName$JpaSchema.java"
>// Description: Java JPA implementation of a $SchemaName$ schema.

$MssSourceLicense$

package $lower DefTopProjectName$.$DefVUnderVersion$.$lower DefSubProjectName$.$lower MfgSchemaName$.jpa;

import java.io.Serializable;
import java.math.*;
import java.time.*;
import java.util.*;
import jakarta.persistence.*;
import jakarta.transaction.Transactional;
import server.markhome.msscf.v3_1.cflib.*;
import server.markhome.msscf.v3_1.cflib.dbutil.*;
import server.markhome.msscf.v3_1.cflib.xml.CFLibXmlUtil;
import org.apache.commons.codec.binary.Base64;
import org.apache.commons.text.StringEscapeUtils;$poptop SchemaDef iterate SchemaRefs( each importJavaPackageSchemaName empty empty )$
import $lower DefTopProjectName$.$DefVUnderVersion$.$lower DefSubProjectName$.$lower MfgSchemaName$.*;

public class $SchemaName$JpaSchema
	implements I$SchemaName$Schema$iterate SchemaRefs( each commaNewlineSchemaSchemaImplementsInterface empty empty )$
{
	protected I$SecSchemaName$Authorization authorization;
	protected I$DefSchemaName$TablePerms tablePerms;
$iterate Types( empty empty each implJpaSchemaParseEnum )$
$iterate SchemaTables( each declJpaSchemaTableTableMember )$
$iterate SchemaTables( each declJpaSchemaTableFactoryMember )$
$implJpaSchemaMoreMethods$$implJpaSchemaTablePermsAccessors$<!--$implJpaSchemaXmlEncodeString$-->}
</GenFile>

	<GenRule GenDef="EnumDef" Name="implJpaSchemaParseEnum"
		>$switch HasDefSchema yes empty default reallyImplJpaSchemaParseEnum$</GenRule>

	<GenRule GenDef="EnumDef" Name="reallyImplJpaSchemaParseEnum"
		>$implJpaSchemaParseEnumParse$$implJpaSchemaParseEnumOrdinal$</GenRule>

	<GenRule GenDef="Value" Name="implJpaSchemaParseEnum"></GenRule>

	<GenRule GenDef="EnumDef" Name="implJpaSchemaParseEnumParse">
	static HashMap&lt;String,$Name$&gt; lookup$Name$ = null;

	public static $Name$ parse$Name$( String value ) {
		$Name$ retval = parse$Name$( $SchemaName$Schema.class.getName(), value );
		return( retval );
	}

	public static $Name$ parse$Name$( String fieldOrClassName, String value ) {
		final String S_ProcName = "parse$Name$";
		if( lookup$Name$ == null ) {
			HashMap&lt;String,$Name$&gt; newMap = new HashMap&lt;String,$Name$&gt;();$iterate Tag( each implJpaSchemaParseEnumAddTagToMap )$
			lookup$Name$ = newMap;
		}
		$Name$ retval;
		if( ( value == null ) || ( value.length() &lt;= 0 ) ) {
			retval = null;
		}
		else {
			retval = lookup$Name$.get( value );
			if( retval == null ) {
				throw new CFLibInvalidArgumentException ( fieldOrClassName,
					fieldOrClassName,
					S_ProcName,
					1,
					"value",
					"Invalid enum limb argument " + value,
					"Invalid enum limb argument " + value );
			}
		}
		return( retval );
	}
</GenRule>

	<GenRule GenDef="EnumTag" Name="implJpaSchemaParseEnumAddTagToMap">
			newMap.put( "$Name$", $popto EnumDef Name$.$Name$ );</GenRule>

	<GenRule GenDef="EnumDef" Name="implJpaSchemaParseEnumOrdinal">
	static HashMap&lt;Integer,$Name$&gt; lookupOrdinal$Name$ = null;

	public static $Name$ ordinalTo$Name$( String fieldOrClassName, Short value ) {
		$Name$ retval;
		if( value == null ) {
			retval = null;
		}
		else {
			retval = ordinalTo$Name$( fieldOrClassName, Integer.valueOf( value.shortValue() ) );
		}
		return( retval );
	}

	public static $Name$ ordinalTo$Name$( Short value ) {
		$Name$ retval;
		if( value == null ) {
			retval = null;
		}
		else {
			retval = ordinalTo$Name$( Integer.valueOf( value.shortValue() ) );
		}
		return( retval );
	}

	public static $Name$ ordinalTo$Name$( Integer value ) {
		$Name$ retval;
		if( value == null ) {
			retval = null;
		}
		else {
			retval = ordinalTo$Name$( $SchemaName$Schema.class.getName(), Integer.valueOf( value.shortValue() ) );
		}
		return( retval );
	}

	public static $Name$ ordinalTo$Name$( String fieldOrClassName, Integer value ) {
		final String S_ProcName = "ordinalTo$Name$";
		if( lookupOrdinal$Name$ == null ) {
			HashMap&lt;Integer,$Name$&gt; newMap = new HashMap&lt;Integer,$Name$&gt;();$iterate Tag( each implJpaSchemaParseEnumAddOrdinalTagToMap )$
			lookupOrdinal$Name$ = newMap;
		}
		$Name$ retval;
		if( value == null ) {
			retval = null;
		}
		else {
			retval = lookupOrdinal$Name$.get( value );
			if( retval == null ) {
				throw new CFLibInvalidArgumentException ( fieldOrClassName,
					fieldOrClassName,
					S_ProcName,
					1,
					"value",
					"Invalid enum ordinal argument " + value.toString(),
					"Invalid enum ordinal argument " + value.toString() );
			}
		}
		return( retval );
	}
</GenRule>

	<GenRule GenDef="EnumTag" Name="implJpaSchemaParseEnumAddOrdinalTagToMap">
			newMap.put( Integer.valueOf( $popto EnumDef Name$.$Name$.ordinal() ), $popto EnumDef Name$.$Name$ );</GenRule>

	<GenRule GenDef="SchemaRef" Name="commaNewlineSchemaSchemaImplementsInterface">,
		I$reference RefSchema SchemaName$Schema</GenRule>

	<GenRule GenDef="SchemaDef" Name="implJpaSchemaMoreMethods"
		>$implJpaSchemaSchemaConstructor$$implJpaSchemaAuthorizationAccessors$$iterate SchemaRefs( first implJpaSchemaNewSchema each empty empty implJpaSchemaNewSchema )$$iterate SchemaRefs( first implJpaSchemaFileImport each empty empty implJpaSchemaFileImport )$$iterate Id16Generators( each implNextIdGen empty empty)$$iterate Id32Generators( each implNextIdGen empty empty)$$iterate Id64Generators( each implNextIdGen empty empty)$$iterate DbKeyHash128Generators( each implNextIdGen empty empty )$$iterate DbKeyHash160Generators( each implNextIdGen empty empty )$$iterate DbKeyHash224Generators( each implNextIdGen empty empty )$$iterate DbKeyHash256Generators( each implNextIdGen empty empty )$$iterate DbKeyHash384Generators( each implNextIdGen empty empty )$$iterate DbKeyHash512Generators( each implNextIdGen empty empty )$$iterate UuidGenerators( each implNextIdGen empty empty )$$iterate Uuid6Generators( each implNextIdGen empty empty )$$iterate SchemaTables( each implJpaTableMethods empty empty )$</GenRule>

	<GenRule ScopeDef="SchemaDef" GenDef="Id16Gen" Name="implNextIdGen">
	@Override
	public short next$Name$() {
		throw new CFLibNotImplementedYetException( getClass(), "next$Name$" );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="Id32Gen" Name="implNextIdGen">
	@Override
	public int next$Name$() {
		throw new CFLibNotImplementedYetException( getClass(), "next$Name$" );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="Id64Gen" Name="implNextIdGen">
	@Override
	public long next$Name$() {
		throw new CFLibNotImplementedYetException( getClass(), "next$Name$" );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="DbKeyHash128Gen" Name="implNextIdGen">
	@Override
	public CFLibDbKeyHash128 next$Name$() {
		CFLibDbKeyHash128 retval = new CFLibDbKeyHash128(0);
		return( retval );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="DbKeyHash160Gen" Name="implNextIdGen">
	@Override
	public CFLibDbKeyHash160 next$Name$() {
		CFLibDbKeyHash160 retval = new CFLibDbKeyHash160(0);
		return( retval );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="DbKeyHash224Gen" Name="implNextIdGen">
	@Override
	public CFLibDbKeyHash224 next$Name$() {
		CFLibDbKeyHash224 retval = new CFLibDbKeyHash224(0);
		return( retval );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="DbKeyHash256Gen" Name="implNextIdGen">
	@Override
	public CFLibDbKeyHash256 next$Name$() {
		CFLibDbKeyHash256 retval = new CFLibDbKeyHash256(0);
		return( retval );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="DbKeyHash384Gen" Name="implNextIdGen">
	@Override
	public CFLibDbKeyHash384 next$Name$() {
		CFLibDbKeyHash384 retval = new CFLibDbKeyHash384(0);
		return( retval );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="DbKeyHash512Gen" Name="implNextIdGen">
	@Override
	public CFLibDbKeyHash512 next$Name$() {
		CFLibDbKeyHash512 retval = new CFLibDbKeyHash512(0);
		return( retval );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="UuidGen" Name="implNextIdGen">
	@Override
	public UUID next$Name$() {
		UUID retval = UUID.randomUUID();
		return( retval );
	}
</GenRule>
	<GenRule ScopeDef="SchemaDef" GenDef="Uuid6Gen" Name="implNextIdGen">
	@Override
	public CFLibUuid6 next$Name$() {
		CFLibUuid6 retval = CFLibUuid6.generate();
		return( retval );
	}
</GenRule>

	<GenRule GenDef="Table" Name="declJpaSchemaTableTableMember"
>	protected I$DefSchemaName$$TableName$Table table$TableName$;
</GenRule>

	<GenRule GenDef="Table" Name="declJpaSchemaTableFactoryMember"
>	protected I$DefSchemaName$$TableName$Factory factory$TableName$;
</GenRule>

	<GenRule GenDef="Table" Name="implJpaTableMethods"
		>$implJpaSchemaTableTableAccessors$$implJpaSchemaTableFactoryAccessors$</GenRule>

	<GenRule GenDef="Object" Name="implJpaSchemaAuthorizationAccessors"
		>$popto SchemaDef implJpaSchemaAuthorizationAccessors$</GenRule>

	<GenRule GenDef="SchemaDef" Name="implJpaSchemaAuthorizationAccessors">
	public $SecSchemaName$Authorization getAuthorization() {
		return( authorization );
	}

	public void setAuthorization( $SecSchemaName$Authorization value ) {
		authorization = value;
	}
</GenRule>

	<GenRule GenDef="SchemaDef" Name="implJpaSchemaTablePermsAccessors">
	public I$DefSchemaName$TablePerms getTablePerms() {
		return( tablePerms );
	}

	public void setTablePerms( I$DefSchemaName$TablePerms value ) {
		tablePerms = value;
	}
</GenRule>

	<GenRule GenDef="Table" Name="implJpaSchemaTableTableAccessors">
	public I$DefSchemaName$$TableName$Table getTable$TableName$() {
		return( table$TableName$ );
	}

	public void setTable$TableName$( I$DefSchemaName$$TableName$Table value ) {
		table$TableName$ = value;
	}
</GenRule>

	<GenRule GenDef="SchemaRef" Name="implJpaSchemaFileImport"
		>$reference RefSchema implJpaSchemaFileImport$</GenRule>

	<GenRule GenDef="SchemaDef" Name="implJpaSchemaFileImport">
	/**
	 *	Import the contents of the specified file name
	 *	and file contents by applying a SAX Loader parse.
	 */
	public String fileImport( $SecSchemaName$Authorization auth, String fileName, String fileContent ) {
		final String S_ProcName = "fileImport";
		throw new CFLibNotImplementedYetException( getClass(),
			S_ProcName,
			"You must overload this method to apply a SAX Parser to the file contents" );
	}
</GenRule>

	<GenRule GenDef="Object" Name="implJpaSchemaFileImport">
	/**
	 *	Import the contents of the specified file name
	 *	and file contents by applying a SAX Loader parse.
	 */
	public String fileImport( $popto SchemaDef SecSchemaName$Authorization auth, String fileName, String fileContent ) {
		final String S_ProcName = "fileImport";
		throw new CFLibNotImplementedYetException( getClass(),
			S_ProcName,
			"You must overload this method to apply a SAX Parser to the file contents" );
	}
</GenRule>

	<GenRule GenDef="Table" Name="implJpaSchemaTableFactoryAccessors">
	public I$DefSchemaName$$TableName$Factory getFactory$TableName$() {
		return( factory$TableName$ );
	}

	public void setFactory$TableName$( I$DefSchemaName$$TableName$Factory value ) {
		factory$TableName$ = value;
	}
</GenRule>

	<GenRule GenDef="Object" Name="implJpaSchemaSchemaConstructor">
	public $poptop SchemaDef SchemaName$JpaSchema() {
$poptop SchemaDef iterate SchemaTables( each initSchemaTableTableMember )$
$poptop SchemaDef iterate SchemaTables( each initSchemaTableFactoryMember )$	}
</GenRule>

	<GenRule GenDef="SchemaRef" Name="implJpaSchemaNewSchema"
		>$reference RefSchema implJpaSchemaNewSchema$</GenRule>

	<GenRule GenDef="SchemaDef" Name="implJpaSchemaNewSchema">
	@Override
	public I$poptop SchemaDef SchemaName$Schema newSchema() {
		throw new CFLibMustOverrideException( getClass(), "newSchema" );
	}
</GenRule>

	<GenRule GenDef="Object" Name="implJpaSchemaNewSchema">
	@Override
	public I$poptop SchemaDef SchemaName$Schema newSchema() {
		throw new CFLibMustOverrideException( getClass(), "newSchema" );
	}
</GenRule>

	<GenRule GenDef="Table" Name="initSchemaTableTableMember">
		table$TableName$ = null;</GenRule>

	<GenRule GenDef="Table" Name="initSchemaTableFactoryMember">
		factory$TableName$ = new $SchemaName$$TableName$DefaultFactory();</GenRule>

	<GenRule GenDef="SchemaDef" Name="implJpaSchemaXmlEncodeString">
	public static String xmlEncodeString( String val ) {
		StringBuffer buff = new StringBuffer();
		int len = val.length();
		for( int idx = 0; idx &lt; len; idx ++ ) {
			char c = val.charAt( idx );
			switch( c ) {
				case '&amp;':
					buff.append( "&amp;amp;" );
					break;
				case '&lt;':
					buff.append( "&amp;lt;" );
					break;
				case '&gt;':
					buff.append( "&amp;gt;" );
					break;
				case '"':
					buff.append( "&amp;quot;" );
					break;
				case '\\'':
					buff.append( "&amp;apos;" );
					break;
				default:
					buff.append( c );
					break;
			}
		}
		return( buff.toString() );
	}
</GenRule>

</RuleSet>
