<?xml version="1.0" encoding="UTF-8"?>
<!--
 *	Mark's Code Fractal CFKBase 3.1 Code Fractal Knowledge Base
 *
 *	Copyright 2016-2026 Mark Stephen Sobkow
 *
 *	This file is part of Mark's Code Fractal CFKBase.
 *
 *	Mark's Code Fractal CFKBase is available under dual commercial license from
 *	Mark Stephen Sobkow, or under the terms of the GNU General Public License,
 *	Version 3 or later.
 *
 *	Mark's Code Fractal CFKBase is free software: you can redistribute it and/or
 *	modify it under the terms of the GNU General Public License as published by
 *	the Free Software Foundation, either version 3 of the License, or
 *	(at your option) any later version.
 *
 *	Mark's Code Fractal CFKBase is distributed in the hope that it will be useful,
 *	but WITHOUT ANY WARRANTY; without even the implied warranty of
 *	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *	GNU General Public License for more details.
 *
 *	You should have received a copy of the GNU General Public License
 *	along with Mark's Code Fractal CFKBase.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
 *
 *	If you wish to modify and use this code without publishing your changes,
 *	or integrate it with proprietary code, please contact Mark Stephen Sobkow
 *	for a commercial license at mark.sobkow@gmail.com
 * -->
<RuleSet
	xmlns="https://msobkow.github.io/msscf/2.0.13/xsd/cfgenkb-2.13-ruleset.xsd"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:xs="http://www.w3.org/2001/XMLSchema"
	xsi:schemaLocation="https://msobkow.github.io/msscf/2.0.13/xsd/cfgenkb-2.13-ruleset.xsd https://msobkow.github.io/msscf/2.0.13/xsd/cfgenkb-2.13-ruleset.xsd"
	ToolSet="java"
	Name="src/Schema/jpahooks/SchemaJpaHooksSchema.java"
	Revision="3.0"
	Descr="Java 25 Spring JPA Hooks for Schema">

	<GenFile GenDef="SchemaDef" Name="fileSchemaJpaHooksSchemaJava"
			GenerateOnce="false"
		ModuleName="$reference ManufacturingSchema lower JavaPackage$.jpahooks"
		SourceBundle="java"
		BasePackageName="$reference ManufacturingSchema lower JavaPackage$.$reference ManufacturingSchema lower SchemaName$jpa/src/main/java"
		SubPackageName="$reference ManufacturingSchema lower JavaPackage$.$reference ManufacturingSchema lower SchemaName$jpahooks"
		ExpansionClassName="$SchemaName$JpaHooksSchemaJava"
		ExpansionKeyName="$SchemaName$JpaHooksSchemaJava"
		ExpansionFileName="$SchemaName$JpaHooksSchema.java"
>// Description: Java 25 Spring JPA Hooks for $SchemaName$

$MssSourceLicense$

package $lower DefTopProjectName$.$DefVUnderVersion$.$lower DefSubProjectName$.$lower DefSchemaName$jpahooks;

import java.io.Serializable;
import java.math.*;
import java.net.InetAddress;
import java.time.*;
import java.util.*;
import jakarta.persistence.*;
import io.github.msobkow.v3_1.cflib.*;
import io.github.msobkow.v3_1.cflib.dbutil.*;
import io.github.msobkow.v3_1.cflib.xml.CFLibXmlUtil;
import org.apache.commons.codec.binary.Base64;
import org.apache.commons.text.StringEscapeUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Service;
import org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;$poptop SchemaDef iterate SchemaRefs( each importJavaPackageSchemaName empty empty )$
import $lower DefTopProjectName$.$DefVUnderVersion$.$lower DefSubProjectName$.$lower DefSchemaName$.*;$iterate SchemaRefs( each importJavaPackageSchemaNameJpa empty empty )$
import $reference ManufacturingSchema lower JavaPackage$.$reference ManufacturingSchema lower SchemaName$.jpa.*;

/**
 *	Hooks for schema $SchemaName$ Spring resources that need to be used by getter-wrappers for AtomicReference members of the multi-threaded wedge between Spring resources and POJO code.
 *	This implementation wraps the Spring singletons instantiated during Spring's boot process for the $reference ManufacturingSchema lower JavaPackage$.$reference ManufacturingSchema lower SchemaName$.jpa package.  It resolves all known standard Spring resources for the LocalContainerEntityManagerFactoryBean, SchemaService, IdGenService, and the $SchemaName$*Repository and $SchemaName$*Service singletons that the POJOs need to invoke.  However, it relies on late-initialization during dynamic instance creation (i.e. new $SchemaName$JpaSchemaHooks()) instead of being initialized as a Spring singleton. As the Spring instance hierarchy is instantiated before any instances of this class are instantiated, the net result bridges the gap between POJO and Spring JPA.
 */
@Service("$lower DefDbSchemaName$JpaHooksSchema")
public class $SchemaName$JpaHooksSchema {
$SchemaJpaHooksClassBody$}
</GenFile>

<GenRule GenDef="SchemaDef" Name="SchemaJpaHooksClassBody">
	@Autowired
	@Qualifier("$lower DefDbSchemaName$EntityManagerFactory")
	private LocalContainerEntityManagerFactoryBean $lower DefDbSchemaName$EntityManagerFactory;
$iterate Tables( each JpaSchemaHooksMaybeAutowireRepository empty empty )$
	@Autowired
	@Qualifier("$lower DefDbSchemaName$JpaSchemaService")
	private $DefSchemaName$JpaSchemaService schemaService;

	@Autowired
	@Qualifier("$SchemaName$JpaIdGenService")
	private $SchemaName$JpaIdGenService idGenService;
$iterate Tables( each JpaSchemaHooksMaybeAutowireService empty empty )$$JpaSchemaHooksGetEntityManagerFactoryBean$$JpaSchemaHooksGetSchemaService$$JpaSchemaHooksGetIdGenService$$iterate Tables( each JpaSchemaHooksMaybeGetTableRepository empty empty )$$iterate Tables( each JpaSchemaHooksMaybeGetTableService empty empty )$</GenRule>

	<GenRule GenDef="SchemaDef" Name="JpaSchemaHooksGetEntityManagerFactoryBean">
	public LocalContainerEntityManagerFactoryBean getEntityManagerFactoryBean() {
		if ( $lower DefDbSchemaName$EntityManagerFactory == null ) {
			// Dynamically resolve the repository by qualifier name
			throw new CFLibNotImplementedYetException( getClass(), "getEntityManagerFactoryBean",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either" );
		}
		return( $lower DefDbSchemaName$EntityManagerFactory );
	}
</GenRule>

	<GenRule GenDef="SchemaDef" Name="JpaSchemaHooksGetSchemaService">
	public $DefSchemaName$JpaSchemaService getSchemaService() {
		if ( schemaService == null ) {
			// Dynamically resolve the repository by qualifier name
			throw new CFLibNotImplementedYetException( getClass(), "getSchemaService",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either" );
		}
		return( schemaService );
	}
</GenRule>

	<GenRule GenDef="SchemaDef" Name="JpaSchemaHooksGetIdGenService">
	public $DefSchemaName$JpaIdGenService getIdGenService() {
		if ( idGenService == null ) {
			// Dynamically resolve the repository by qualifier name
			throw new CFLibNotImplementedYetException( getClass(), "getIdGenService",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either" );
		}
		return( idGenService );
	}
</GenRule>

	<GenRule GenDef="Table" Name="JpaSchemaHooksMaybeAutowireRepository">$switch HasDefSchema yes empty default JpaSchemaHooksAutowireRepository$</GenRule>
	<GenRule GenDef="Table" Name="JpaSchemaHooksAutowireRepository">
	@Autowired
	private $DefSchemaName$Jpa$TableName$Repository $leadlower TableName$Repository;
</GenRule>

	<GenRule GenDef="Table" Name="JpaSchemaHooksMaybeAutowireService">$switch HasDefSchema yes empty default JpaSchemaHooksAutowireService$</GenRule>
	<GenRule GenDef="Table" Name="JpaSchemaHooksAutowireService">
	@Autowired
	@Qualifier("$lower DefDbSchemaName$Jpa$TableName$Service")
	private $DefSchemaName$Jpa$TableName$Service $leadlower TableName$Service;
</GenRule>

	<GenRule GenDef="Table" Name="JpaSchemaHooksMaybeGetTableRepository">$switch HasDefSchema yes empty default JpaSchemaHooksGetTableRepository$</GenRule>
	<GenRule GenDef="Table" Name="JpaSchemaHooksGetTableRepository">
	public $DefSchemaName$Jpa$TableName$Repository get$TableName$Repository() {
		if ( $leadlower TableName$Repository == null ) {
			// Dynamically resolve the repository by interface type
			throw new CFLibNotImplementedYetException( getClass(), "get$TableName$Repository",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either" );
		}
		return( $leadlower TableName$Repository );
	}
</GenRule>

	<GenRule GenDef="Table" Name="JpaSchemaHooksMaybeGetTableService">$switch HasDefSchema yes empty default JpaSchemaHooksGetTableService$</GenRule>
	<GenRule GenDef="Table" Name="JpaSchemaHooksGetTableService">
	public $DefSchemaName$Jpa$TableName$Service get$TableName$Service() {
		if ( $leadlower TableName$Service == null ) {
			// Dynamically resolve the repository by qualifier name
			throw new CFLibNotImplementedYetException( getClass(), "get$TableName$Service",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either",
				"ERROR - do not know how to dynamically resolve Spring beans from POJO code yet and AspectJ did not resolve it either" );
		}
		return( $leadlower TableName$Service );
	}
</GenRule>

</RuleSet>
